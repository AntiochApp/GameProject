<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Pilgrim’s Journey – Login</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Georgia", serif;
      background: url('bg_pilgrim.png') center/cover no-repeat fixed;
    }

    .overlay {
      width: 100%;
      min-height: 100vh;
      background: rgba(0,0,0,0.45);
      padding: 40px 20px;
      box-sizing: border-box;
    }

    .banner {
      width: 100%;
      max-width: 460px;
      margin: 0 auto 20px;
      height: 160px;
      background: url('pilgrim_banner.png') center/contain no-repeat;
    }

    .card {
      max-width: 380px;
      margin: 20px auto;
      background: rgba(255, 248, 230, 0.95);
      padding: 30px;
      border-radius: 14px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
      border: 2px solid #d3b58f;
      backdrop-filter: blur(2px);
    }

    h2 {
      text-align: center;
      color: #5d4024;
      margin-top: 0;
      font-weight: bold;
    }

    .logo {
      width: 90px;
      display: block;
      margin: 0 auto 10px;
    }

    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #c9a775;
      border-radius: 8px;
      margin-bottom: 16px;
      background: #fffaf2;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #8e5b32;
      color: white;
      font-size: 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 6px;
    }
    button:hover {
      background: #6f4526;
    }

    .link-row {
      text-align: center;
      margin-top: 10px;
      font-size: 13px;
    }

    .link-btn {
      font-size: 13px;
      color: #5d4024;
      cursor: pointer;
      margin: 0 6px;
      text-decoration: underline;
    }
  </style>
</head>

<body>
<div class="overlay">

  <div class="banner"></div>

  <!-- LOGIN -->
  <div class="card" id="loginBox">
    <img src="pilgrim_icon.png" class="logo" alt="icon">
    <h2>ANTIOCH GAME</h2>

    <input type="text" id="loginId" placeholder="ID">
    <input type="password" id="loginPw" placeholder="PASSWORD">

    <button onclick="login()">로그인하기</button>

    <div class="link-row">
      <span class="link-btn" onclick="showFindPw()">비밀번호 찾기</span> |
      <span class="link-btn" onclick="showSignup()">회원가입</span>
    </div>
  </div>

  <!-- SIGN UP -->
  <div class="card" id="signupBox" style="display:none;">
    <h2>회원가입 / Sign Up</h2>
    <input type="text" id="newId" placeholder="ID">
    <input type="password" id="newPw" placeholder="NEW PASSWORD">
    <input type="text" id="newName" placeholder="NAME">
    <input type="text" id="newFav" placeholder="My Favorite Bible Character">
    <button onclick="signup()">가입하기</button>
    <div class="link-row">
      <span class="link-btn" onclick="showLogin()">로그인으로 돌아가기</span>
    </div>
  </div>

  <!-- FIND PASSWORD -->
  <div class="card" id="findPwBox" style="display:none;">
    <h2>비밀번호 찾기 / Find Password</h2>
    <input type="text" id="findName" placeholder="REAL NAME">
    <input type="text" id="findFav" placeholder="My Favorite Bible Character">
    <button onclick="findPw()">비밀번호 찾기</button>
    <div class="link-row">
      <span class="link-btn" onclick="showLogin()">로그인으로 돌아가기</span>
    </div>
  </div>

</div>

<script>
  // ★ 여기를 너의 웹앱 URL로 바꿔줘 ★
  const API_URL = "https://script.google.com/macros/s/AKfycbwUqF_7np5AgJTygWKEn8diNyiFmvAnHaSsY0Xz3zVMuw5bGnn6y2Wr35zmq-w_ZuHyTQ/exec";

  // 화면 전환
  function showSignup() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("signupBox").style.display = "block";
    document.getElementById("findPwBox").style.display = "none";
  }

  function showFindPw() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("signupBox").style.display = "none";
    document.getElementById("findPwBox").style.display = "block";
  }

  function showLogin() {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("signupBox").style.display = "none";
    document.getElementById("findPwBox").style.display = "none";
  }

  // 회원가입
  async function signup() {
    const id = document.getElementById("newId").value.trim();
    const password = document.getElementById("newPw").value.trim();
    const name = document.getElementById("newName").value.trim();
    const bible = document.getElementById("newFav").value.trim();

    if (!id || !password || !name || !bible) {
      alert("모든 칸을 채워주세요!");
      return;
    }

    await fetch(API_URL, {
      method: "POST",
      // **헤더 안 넣는다! (중요: CORS 단순 요청 유지)**
      body: JSON.stringify({
        type: "signup",
        id, password, name, bible
      })
    });

    alert("회원가입 완료!");
    showLogin();
  }

  // 로그인
  async function login() {
    const id = document.getElementById("loginId").value.trim();
    const password = document.getElementById("loginPw").value.trim();

    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        type: "login",
        id, password
      })
    });

    const text = await res.text();
    if (text === "login_fail") {
      alert("로그인 실패! ID / PW를 다시 확인해 주세요.");
      return;
    }

    const data = JSON.parse(text);
    alert(`로그인 성공!\n이름: ${data.name}\n좋아하는 인물: ${data.bible}`);

    // 여기서부터 game.html로 이동하거나, 게임 화면을 띄우면 됨
    // window.location.href = "game.html";
  }

  // 비밀번호 찾기
  async function findPw() {
    const name = document.getElementById("findName").value.trim();
    const bible = document.getElementById("findFav").value.trim();

    const res = await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        type: "findPw",
        name, bible
      })
    });

    const text = await res.text();
    if (text === "not_found") {
      alert("일치하는 정보를 찾을 수 없습니다.");
      return;
    }

    const data = JSON.parse(text);
    alert(`ID: ${data.id}\nPW: ${data.password}`);
  }
</script>

</body>
</html>

